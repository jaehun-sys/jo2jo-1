<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.metanet.jo2jo.repository.Educated.EducatedRepository">

	<!-- 교육이수 조회 -->
	<select id="selectEducated" parameterType="EmployeeDetailDto" resultType="EducatedSelectDto">
		 <![CDATA[
			SELECT EMPNAME AS empname,
				   CURRNAME AS currname,
				   CONTENT AS content,
				   INSTRUCTOR AS instructor,
				   STARTDATE  AS startdate,
				   ENDDATE AS enddate,
				   EDUSTATE AS edustate
			FROM EMPLOYEE e ,CURRICULUM c , EDUCATED e2
			WHERE e.EMPNO = e2.EMPNO 
			AND c.CURRNO = e2.CURRNO 
			AND e.EMPNO = #{empno}
	    ]]>
	</select>

	<!--수강 신청-->
	<insert id="insertEducated" parameterType="EducatedDto">
		INSERT
		INTO EDUCATED (	EDUNO
					  , EMPNO
					  , CURRNO
					  , EDUSTATE
					  , ACHIEVEMENT
					  )
		VALUES  ( SEQ_EDUCATED_NO.NEXTVAL
				, #{empno}
				, #{currno}
				, 0
				, 0
				)
	</insert>

	<!--수강 업데이트-->
	<update id="updateEducated" parameterType="EducatedDto">
		UPDATE EDUCATED
		SET	  EDUSTATE		=  #{edustate}
			, ACHIEVEMENT	=  100 * (SELECT 1/COSTOTALCNT
									  FROM   CURRICULUM C
									  WHERE  C.CURRNO = #{currno}
									  )
		WHERE CURRNO = #{currno}
	</update>

	<!--수강 삭제-->
	<delete id="deleteEducated" parameterType="EducatedDto">
		DELETE
		FROM	EDUCATED
		WHERE		CURRNO = #{currno}
				OR	EMPNO = #{empno}
	</delete>
</mapper>